<div class="container">
  <!-- Header Row -->
  <div class="sort-buttons header-row">
    <button mat-raised-button (click)="sortData('testId')">
      Sort by Test ID
      <mat-icon *ngIf="currentSortColumn === 'testId'">
        {{ sortDirection === 'asc' ? 'arrow_drop_up' : 'arrow_drop_down' }}
      </mat-icon>
    </button>
    <button mat-raised-button (click)="sortData('points')">
      Sort by Points
      <mat-icon *ngIf="currentSortColumn === 'points'">
        {{ sortDirection === 'asc' ? 'arrow_drop_up' : 'arrow_drop_down' }}
      </mat-icon>
    </button>
    <button mat-raised-button (click)="sortData('date')">
      Sort by Date
      <mat-icon *ngIf="currentSortColumn === 'date'">
        {{ sortDirection === 'asc' ? 'arrow_drop_up' : 'arrow_drop_down' }}
      </mat-icon>
    </button>
  </div>

  <!-- Accordion for Test Submissions -->
  <mat-accordion>
    <mat-expansion-panel *ngFor="let test of pagedTests" [hideToggle]="!test.test_exercises?.length">
      <mat-expansion-panel-header>
        <div class="data-row">
          <span class="data-cell">Test ID: {{ test.test_id }}</span>
          <span class="data-cell">Points: {{ test.points_scored }} / {{ test.max_points }}</span>
          <span class="data-cell">Date: {{ test.submission_date | date: 'short' }}</span>
        </div>
      </mat-expansion-panel-header>

      <!-- Details: List of Exercises -->
      <ng-container *ngIf="test.test_exercises && test.test_exercises.length">
        <div *ngFor="let exercise of test.test_exercises" class="exercise-detail">
          <p>
            <strong>Description:</strong>
            {{ exercise.description }}
          </p>
          <p>
            <strong>Correct Answer:</strong>
            {{ exercise.correct_answer }}
          </p>
          <p>
            <strong>Points:</strong>
            {{ exercise.points }}
          </p>
          <p>
            <strong>Difficulty:</strong>
            {{ exercise.difficulty_level }}
          </p>
          <p>
            <strong>Your Answer:</strong>
            {{ exercise.userAnswer || 'N/A' }}
          </p>
          <p>
            <strong>Hints Used:</strong>
            {{ exercise.hints_used || '0' }}
          </p>
        </div>
      </ng-container>
    </mat-expansion-panel>
  </mat-accordion>

  <!-- Paginator -->
  <mat-paginator
    [length]="filteredTests.length"
    [pageSize]="pageSize"
    [pageSizeOptions]="[5, 10, 25]"
    (page)="onPageChange($event)"
    aria-label="Select page of test submissions"></mat-paginator>

  <div class="percentile-card" *ngIf="userOverallPercentile">
    Your overall performance is in the
    <strong>{{ userOverallPercentile | number: '1.0-2' }}%</strong>
    percentile.
  </div>
</div>
